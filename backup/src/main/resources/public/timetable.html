<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Scheduler â€“ Timetable</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/global-theme.css">
  <link rel="stylesheet" href="/css/modern-exact-design.css">
  <link rel="stylesheet" href="/css/timetable.css">
  <link rel="stylesheet" href="/css/overrides.dev.css?v=20251104">
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="logo">
        <svg class="icon" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path d="M24 4C25.7818 14.2173 33.7827 22.2182 44 24C33.7827 25.7818 25.7818 33.7827 24 44C22.2182 33.7827 14.2173 25.7818 4 24C14.2173 22.2182 22.2182 14.2173 24 4Z" fill="currentColor"/>
        </svg>
        <h1>Smart Scheduler</h1>
      </div>

      <nav class="nav">
        <a href="dashboard.html">Dashboard</a>
        <a href="timetable.html" class="active">Timetable</a>
        <a href="rooms.html">Rooms</a>
        <a href="users.html">Teachers</a>
        <a href="courses.html">Courses</a>
      </nav>

      <div class="actions">
        <button id="themeToggle" class="theme-toggle-btn" aria-label="Switch theme">
          <span id="themeIcon">ðŸŒ™</span>
        </button>
        <button class="bell" id="notifications">
          <svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
            <path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06Z"/>
          </svg>
        </button>
        <div class="avatar" id="profileMenu"></div>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <!-- Page Header Content Box - matches Courses/Dashboard structure -->
      <div class="content-box">
        <h2 class="page-title">Weekly Timetable</h2>
        <p class="text-muted">View and manage your weekly schedule of classes, rooms, and faculty.</p>
        
        <div class="filter-bar">
          <button class="add-course-btn" id="addSchedule">
            <svg style="width: 1rem; height: 1rem; margin-right: 0.5rem;" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            Add Entry
          </button>
          
          <div class="date-nav">
            <button class="nav-btn" id="prevWeek">
              <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
            </button>
            <span class="current-date" id="currentWeek">October 7 - 11, 2025</span>
            <button class="nav-btn" id="nextWeek">
              <svg viewBox="0 0 24 24"><path d="M10.59 6L12 7.41 16.17 12l-4.17 4.59L10.59 18l6-6z"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Timetable Content Box -->
      <div class="content-box">

      <!-- Timetable Content Box -->
      <div class="content-box">
        <h3 class="section-title">Class Schedule</h3>
        
        <div class="timetable-wrapper">
          <table class="timetable" id="weeklyTimetable">
          <thead>
            <tr>
              <th style="width: 120px;">TIME</th>
              <th>DAY ORDER-1</th>
              <th>DAY ORDER-2</th>
              <th>DAY ORDER-3</th>
              <th>DAY ORDER-4</th>
              <th>DAY ORDER-5</th>
            </tr>
          </thead>
          <tbody>
            <!-- Row 1: 08:00â€“08:50 -->
            <tr>
              <td class="time-slot">08:00â€“08:50</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Data Structures and Algorithms</strong><br>
                Dr. Kalpana C - CLS619<br>
                <small style="color: var(--gray-500);">Slot B</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Advanced Programming Practice Lab</strong><br>
                Dr. Prince Chelladurai S - CLS619<br>
                <small style="color: var(--gray-500);">Slot P31</small>
              </td>
              <td>
                <strong>Data Structures Lab</strong><br>
                Dr. Kalpana C - UB713B<br>
                <small style="color: var(--gray-500);">Slot L</small>
              </td>
            </tr>
            
            <!-- Row 2: 08:50â€“09:40 -->
            <tr>
              <td class="time-slot">08:50â€“09:40</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Data Structures and Algorithms</strong><br>
                Dr. Kalpana C - CLS619<br>
                <small style="color: var(--gray-500);">Slot B</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Advanced Programming Practice Lab</strong><br>
                Dr. Prince Chelladurai S - CLS619<br>
                <small style="color: var(--gray-500);">Slot P32</small>
              </td>
              <td>
                <strong>Data Structures Lab</strong><br>
                Dr. Kalpana C - UB713B<br>
                <small style="color: var(--gray-500);">Slot L</small>
              </td>
            </tr>
            
            <!-- Row 3: 09:45â€“10:35 -->
            <tr>
              <td class="time-slot">09:45â€“10:35</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>UHV-II: Universal Human Values</strong><br>
                Dr. D. Boopathi - To Be Allotted<br>
                <small style="color: var(--gray-500);">Slot G</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Data Structures and Algorithms</strong><br>
                Dr. Kalpana C - CLS619<br>
                <small style="color: var(--gray-500);">Slot B</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
            </tr>
            
            <!-- Row 4: 10:40â€“11:30 -->
            <tr>
              <td class="time-slot">10:40â€“11:30</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>UHV-II: Universal Human Values</strong><br>
                Dr. D. Boopathi - To Be Allotted<br>
                <small style="color: var(--gray-500);">Slot G</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Data Structures and Algorithms</strong><br>
                Dr. Kalpana C - CLS619<br>
                <small style="color: var(--gray-500);">Slot B</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
            </tr>
            
            <!-- Row 5: 11:35â€“12:25 -->
            <tr>
              <td class="time-slot">11:35â€“12:25</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Transforms and Boundary Value Problems</strong><br>
                Dr. P. Godhandaraman - CLS619<br>
                <small style="color: var(--gray-500);">Slot A</small>
              </td>
              <td>
                <strong>Professional Ethics</strong><br>
                Dr. B. Monika Nair - Online<br>
                <small style="color: var(--gray-500);">Slot E</small>
              </td>
              <td>
                <strong>Computer Organization and Architecture</strong><br>
                Dr. Meenakshi M - CLS619<br>
                <small style="color: var(--gray-500);">Slot C</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
            </tr>
            
            <!-- Row 6: 12:30â€“01:20 -->
            <tr>
              <td class="time-slot">12:30â€“01:20</td>
              <td>
                <strong>Transforms and Boundary Value Problems</strong><br>
                Dr. P. Godhandaraman - CLS619<br>
                <small style="color: var(--gray-500);">Slot A</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Computer Organization and Architecture</strong><br>
                Dr. Meenakshi M - CLS619<br>
                <small style="color: var(--gray-500);">Slot C</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Data Structures and Algorithms</strong><br>
                Dr. Kalpana C - CLS619<br>
                <small style="color: var(--gray-500);">Slot B</small>
              </td>
            </tr>
            
            <!-- Row 7: 01:25â€“02:15 -->
            <tr>
              <td class="time-slot">01:25â€“02:15</td>
              <td>
                <strong>Transforms and Boundary Value Problems</strong><br>
                Dr. P. Godhandaraman - CLS619<br>
                <small style="color: var(--gray-500);">Slot A</small>
              </td>
              <td>
                <strong>Operating Systems Lab</strong><br>
                Dr. G. Priyadharshini - UB711B<br>
                <small style="color: var(--gray-500);">Slot P11</small>
              </td>
              <td>
                <strong>Computer Organization and Architecture</strong><br>
                Dr. Meenakshi M - CLS619<br>
                <small style="color: var(--gray-500);">Slot C</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
            </tr>
            
            <!-- Row 8: 02:20â€“03:10 -->
            <tr>
              <td class="time-slot">02:20â€“03:10</td>
              <td>
                <strong>Operating Systems</strong><br>
                Dr. G. Priyadharshini - CLS619<br>
                <small style="color: var(--gray-500);">Slot F</small>
              </td>
              <td>
                <strong>Operating Systems Lab</strong><br>
                Dr. G. Priyadharshini - UB711B<br>
                <small style="color: var(--gray-500);">Slot P12</small>
              </td>
              <td>
                <strong>Transforms and Boundary Value Problems</strong><br>
                Dr. P. Godhandaraman - CLS619<br>
                <small style="color: var(--gray-500);">Slot A</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Computer Organization and Architecture</strong><br>
                Dr. Meenakshi M - CLS619<br>
                <small style="color: var(--gray-500);">Slot C</small>
              </td>
            </tr>
            
            <!-- Row 9: 03:10â€“04:00 -->
            <tr>
              <td class="time-slot">03:10â€“04:00</td>
              <td>
                <strong>Operating Systems</strong><br>
                Dr. G. Priyadharshini - CLS619<br>
                <small style="color: var(--gray-500);">Slot F</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Advanced Programming Practice</strong><br>
                Dr. Prince Chelladurai S - CLS619<br>
                <small style="color: var(--gray-500);">Slot D</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Operating Systems</strong><br>
                Dr. G. Priyadharshini - CLS619<br>
                <small style="color: var(--gray-500);">Slot F</small>
              </td>
            </tr>
            
            <!-- Row 10: 04:00â€“04:50 -->
            <tr>
              <td class="time-slot">04:00â€“04:50</td>
              <td>
                <strong>UHV-II: Universal Human Values</strong><br>
                Dr. D. Boopathi - To Be Allotted<br>
                <small style="color: var(--gray-500);">Slot G</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Data Structures and Algorithms</strong><br>
                Dr. Kalpana C - CLS619<br>
                <small style="color: var(--gray-500);">Slot B</small>
              </td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td>
                <strong>Advanced Programming Practice</strong><br>
                Dr. Prince Chelladurai S - CLS619<br>
                <small style="color: var(--gray-500);">Slot D</small>
              </td>
            </tr>
            
            <!-- Row 11: 04:50â€“05:30 -->
            <tr>
              <td class="time-slot">04:50â€“05:30</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
            </tr>
            
            <!-- Row 12: 05:30â€“06:10 -->
            <tr>
              <td class="time-slot">05:30â€“06:10</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
              <td style="color: var(--gray-400); text-align: center;">Break</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="legend">
        <div class="legend-item">
          <span class="legend-color legend-color-lecture"></span>
          <span>Lecture</span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-lab"></span>
          <span>Lab</span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-project"></span>
          <span>Project</span>
        </div>
      </div>
    </div>
    </div>
  </main>

  <!-- Add Entry Modal -->
  <div id="addEntryModal" class="modal-backdrop" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h3>Add Timetable Entry</h3>
        <button onclick="closeEntryModal()" class="modal-close">&times;</button>
      </div>
      
      <form id="entryForm" class="modal-content" onsubmit="handleAddEntry(event)">
        <div class="form-group">
          <label class="form-label">Course Name *</label>
          <input type="text" id="entryCourseName" class="form-input" placeholder="e.g., Data Structures and Algorithms" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Faculty *</label>
          <input type="text" id="entryFaculty" class="form-input" placeholder="e.g., Dr. Kalpana C" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Room *</label>
          <input type="text" id="entryRoom" class="form-input" placeholder="e.g., CLS619" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Day Order *</label>
          <select id="entryDay" class="form-input" required>
            <option value="">Select Day</option>
            <option value="1">Day Order-1</option>
            <option value="2">Day Order-2</option>
            <option value="3">Day Order-3</option>
            <option value="4">Day Order-4</option>
            <option value="5">Day Order-5</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Time Slot *</label>
          <select id="entryTimeSlot" class="form-input" required>
            <option value="">Select Time Slot</option>
            <option value="08:00â€“08:50">08:00â€“08:50</option>
            <option value="08:50â€“09:40">08:50â€“09:40</option>
            <option value="09:45â€“10:35">09:45â€“10:35</option>
            <option value="10:40â€“11:30">10:40â€“11:30</option>
            <option value="11:35â€“12:25">11:35â€“12:25</option>
            <option value="12:30â€“13:20">12:30â€“13:20</option>
            <option value="13:25â€“14:15">13:25â€“14:15</option>
            <option value="14:20â€“15:10">14:20â€“15:10</option>
            <option value="15:10â€“16:00">15:10â€“16:00</option>
            <option value="16:00â€“16:50">16:00â€“16:50</option>
            <option value="16:50â€“17:30">16:50â€“17:30</option>
            <option value="17:30â€“18:10">17:30â€“18:10</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Slot Code</label>
          <input type="text" id="entrySlot" class="form-input" placeholder="e.g., Slot B (optional)">
          <small class="form-help">Optional slot identifier</small>
        </div>
        
        <div class="form-group">
          <label class="form-label">Type *</label>
          <select id="entryType" class="form-input" required>
            <option value="lecture">Lecture</option>
            <option value="lab">Lab</option>
            <option value="project">Project</option>
          </select>
        </div>
        
        <div class="modal-footer">
          <button type="button" onclick="closeEntryModal()" class="btn-secondary">Cancel</button>
          <button type="submit" class="btn-primary">Add Entry</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 Smart Timetable</p>
    </div>
  </footer>

  <script src="js/theme.js"></script>
  <script src="js/simple-app.js"></script>
  <script src="js/timetable.js"></script>
  
  <script>
    // Modal handling functions
    function openEntryModal() {
      const modal = document.getElementById('addEntryModal');
      if (modal) {
        modal.style.display = 'flex';
        document.getElementById('entryForm').reset();
      }
    }

    function closeEntryModal() {
      const modal = document.getElementById('addEntryModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    async function handleAddEntry(event) {
      event.preventDefault();
      
      const courseName = document.getElementById('entryCourseName').value;
      const faculty = document.getElementById('entryFaculty').value;
      const room = document.getElementById('entryRoom').value;
      const day = document.getElementById('entryDay').value;
      const timeSlot = document.getElementById('entryTimeSlot').value;
      const slot = document.getElementById('entrySlot').value;
      const type = document.getElementById('entryType').value;
      
      // Split time slot - handle both en-dash (â€“) and regular dash (-)
      const [startTime, endTime] = timeSlot.split(/[â€“-]/).map(t => t.trim());
      
      const entry = {
        courseName, faculty, room,
        dayOfWeek: day,
        startTime: startTime,
        endTime: endTime,
        slotCode: slot,
        type
      };
      
      try {
        const response = await fetch('/api/timetable/add', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + (localStorage.getItem('token') || 'admin')
          },
          body: JSON.stringify(entry)
        });
        
        const result = await response.json();
        
        if (result.success) {
          showNotification('Timetable entry added successfully!', 'success');
          closeEntryModal();
          setTimeout(() => location.reload(), 1000);
        } else {
          showNotification(result.message || 'Failed to add entry', 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showNotification('Failed to add entry. Please try again.', 'error');
      }
    }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed; top: 80px; right: 20px; padding: 1rem 1.5rem;
        background: ${type === 'success' ? '#10b981' : '#ef4444'};
        color: white; border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000;
        animation: slideIn 0.3s ease-out; max-width: 300px;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Setup add button
    document.addEventListener('DOMContentLoaded', () => {
      const addBtn = document.getElementById('addSchedule');
      if (addBtn) addBtn.addEventListener('click', openEntryModal);
      
      const modal = document.getElementById('addEntryModal');
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeEntryModal();
        });
      }
    });
  </script>
</body>
</html>


